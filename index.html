<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>羽毛球极速记分板</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background-color: #f5f5f5;
            color: var(--primary-color);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-family: 'Arial Black', 'Microsoft YaHei', sans-serif;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #777;
            font-style: italic;
            border-top: 1px dashed #ddd;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        /* Scoreboard styles */
        .scoreboard {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        .score-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
        }
        .team-container {
            display: flex;
            justify-content: center;
            gap: 60px;
            width: 100%;
        }
        .team {
            text-align: center;
        }
        .team-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .score {
            font-size: 5rem;
            font-weight: bold;
            color: var(--primary-color);
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 5px solid var(--dark-color);
            border-radius: 10px;
            margin: 0 auto 20px;
        }
        .score-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-dark {
            background-color: var(--dark-color);
            color: white;
        }
        .btn-dark:hover {
            background-color: #2c3e50;
        }
        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        /* Result card styles */
        .result-card {
            background-color: white;
            border-radius: 15px;
            /* 添加白边凸框效果 */
            border: 8px solid white;
            box-shadow: 0 0 0 1px #e0e0e0, 0 4px 12px rgba(0,0,0,0.15);
            outline: 1px solid #f0f0f0;
            outline-offset: -5px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }
        .result-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
        }
        .result-score {
            font-size: 3rem;
            margin: 20px 0;
        }
        /* Grouping styles */
        .grouping-container {
            padding: 20px;
        }
        .players-input {
            margin-bottom: 20px;
        }
        .players-input textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
            resize: none;
        }
        .group-results {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }
        #group-results .group-card {
            background-color: white;
            border-radius: 10px;
            /* 添加白边凸框效果 */
            border: 8px solid white !important;
            box-shadow: 0 0 0 1px #e0e0e0, 0 4px 12px rgba(0,0,0,0.15) !important;
            outline: 1px solid #f0f0f0 !important;
            outline-offset: -5px !important;
            padding: 20px;
            width: 250px;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
            height: 150px;
        }
        .group-card.flipped {
            transform: rotateY(180deg);
        }
        .group-card-front, .group-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .group-card-back {
            transform: rotateY(180deg);
        }
        .group-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        /* Expense tracker styles */
        .expense-tracker {
            padding: 20px;
        }
        .expense-form {
            background-color: white;
            border-radius: 10px;
            /* 添加白边凸框效果 */
            border: 8px solid white;
            box-shadow: 0 0 0 1px #e0e0e0, 0 4px 12px rgba(0,0,0,0.15);
            outline: 1px solid #f0f0f0;
            outline-offset: -5px;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }
        .participants-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .participant-checkbox {
            display: none;
        }
        .participant-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: #eee;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .participant-checkbox:checked + .participant-label {
            background-color: var(--secondary-color);
            color: white;
        }
        .expense-result {
            margin-top: 30px;
            background-color: white;
            border-radius: 10px;
            /* 添加白边凸框效果 */
            border: 8px solid white;
            box-shadow: 0 0 0 1px #e0e0e0, 0 4px 12px rgba(0,0,0,0.15);
            outline: 1px solid #f0f0f0;
            outline-offset: -5px;
            padding: 20px;
        }
        .expense-summary {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        .expense-details {
            margin-top: 20px;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        /* Navigation */
        .nav-tabs {
            display: flex;
            list-style: none;
            margin-bottom: 30px;
            border-bottom: 1px solid #ddd;
        }
        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .nav-tab.active {
            border-bottom-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        /* Responsive design */
        @media (max-width: 768px) {
            .score-display {
                flex-direction: column;
                gap: 30px;
            }
            .score {
                font-size: 4rem;
                width: 120px;
                height: 120px;
            }
            .control-panel {
                flex-wrap: wrap;
            }
            .btn {
                padding: 12px 24px;
                font-size: 1rem;
            }
        }
        /* Landscape mode for score projection */
        @media (orientation: landscape) and (max-height: 500px) {
            .scoreboard {
                padding: 15px;
                margin-bottom: 15px;
            }
            .score-display {
                margin-bottom: 20px;
            }
            .score {
                font-size: 3.5rem;
                width: 100px;
                height: 100px;
            }
            .team-name {
                font-size: 1.2rem;
            }
            h1 {
                font-size: 1.8rem;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>羽毛球极速记分板</h1>
            <p style="font-family: 'Brush Script MT', cursive; font-size: 1.5em; background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1); -webkit-background-clip: text; color: transparent; text-align: center;">设计者：亍幵 南北<br>开发者：亍幵（张鑫）<br>QQ: 1822520752 (建议联系)</p>
        </header>

        <ul class="nav-tabs">
            <li class="nav-tab active" data-screen="scoreboard">记分板</li>
            <li class="nav-tab" data-screen="grouping">智能分组</li>
            <li class="nav-tab" data-screen="expense">费用计算</li>
        </ul>

        <!-- Scoreboard Screen -->
        <div id="scoreboard" class="screen active">
            <div class="scoreboard">
                <div class="score-display">
                    <div style="text-align: center; width: 100%; margin-bottom: 20px;">
                        <span style="font-size: 1.5rem; font-weight: bold;">比赛时长: </span>
                        <span id="match-timer" style="font-size: 1.5rem; font-weight: bold; color: var(--accent-color);">00:00</span>
                    </div>
                    <div class="team-container">
                    <div class="team">
                        <div class="team-name">己方</div>
                        <div class="score" id="team-a-score">0</div>
                        <div class="score-controls">
                            <button class="btn btn-primary" onclick="updateScore('a', 1)">+1</button>
                            <button class="btn btn-danger" onclick="updateScore('a', -1)">-1</button>
                        </div>
                    </div>
                    <div class="team">
                        <div class="team-name">对方</div>
                        <div class="score" id="team-b-score">0</div>
                        <div class="score-controls">
                            <button class="btn btn-primary" onclick="updateScore('b', 1)">+1</button>
                            <button class="btn btn-danger" onclick="updateScore('b', -1)">-1</button>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="control-panel">
                    <button class="btn btn-dark" onclick="resetScore()">重置比分</button>
                    <button class="btn btn-primary" id="timer-button" onclick="toggleTimer()">开始比赛</button>
                    <button class="btn btn-primary" onclick="showResultForm()">结束比赛</button>
                </div>
            </div>

            <!-- Result Form (Hidden by default) -->
            <div id="result-form" class="result-card" style="display: none;">
                <h2 class="result-title">比赛结果</h2>
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <div class="form-group" style="flex: 1;">
                    <label for="team-a-names">己方选手（格式：老王/老张）</label>
                    <input type="text" id="team-a-names" placeholder="例如：老王/老张">
                </div>
                <div style="display: flex; align-items: flex-end; padding-bottom: 24px;">vs</div>
                <div class="form-group" style="flex: 1;">
                    <label for="team-b-names">对方选手（格式：小李/小陈）</label>
                    <input type="text" id="team-b-names" placeholder="例如：小李/小陈">
                </div>
            </div>
                <button class="btn btn-primary" onclick="generateResult()">生成赛果卡片</button>
            </div>

            <!-- Result Card (Hidden by default) -->
            <div id="result-card" class="result-card" style="display: none;">
        <h2 class="result-title" id="result-title-text"></h2>
        <div class="result-score" id="result-score-text"></div>
        <div class="match-date" id="match-date"></div>
        <button class="btn btn-primary" onclick="shareResult()">分享结果</button>
        <button class="btn btn-dark" onclick="generatePoster()" style="margin-top: 10px;">打开海报</button>
    </div>
        </div>

        <!-- Grouping Screen -->
        <div id="grouping" class="screen">
            <div class="grouping-container">
                <div class="players-input">
                    <label for="players-list">输入参与人员（每行一个名字）</label>
                    <textarea id="players-list" placeholder="张三
李四
王五
赵六
钱七
孙八"></textarea>
                </div>
                <div class="control-panel">
                    <button class="btn btn-primary" onclick="randomGroups()">随机分组</button>
                    <button class="btn btn-dark" onclick="clearGroups()">清空结果</button>
                </div>
                <div class="group-results" id="group-results">
                    <!-- Group results will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Expense Tracker Screen -->
        <div id="expense" class="screen">
            <div class="expense-tracker">
                <div class="expense-form">
                    <div class="form-group">
                        <label for="expense-type">费用类型</label>
                        <select id="expense-type">
                            <option value="场地费">场地费</option>
                            <option value="球费">球费</option>
                            <option value="饮用水">饮用水</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="total-amount">总金额 (元)</label>
                        <input type="number" id="total-amount" min="0" step="0.01" placeholder="输入总金额">
                    </div>
                    <div class="form-group">
                        <label>参与人员</label>
                        <div class="players-input">
                            <textarea id="expense-players" placeholder="张三
李四
王五
赵六
钱七
孙八"></textarea>
                        </div>
                        <div class="participants-list" id="participants-list">
                            <!-- Participants will be inserted here -->
                        </div>
                        <button class="btn btn-primary" style="margin-top: 15px;" onclick="generateParticipants()">生成选择框</button>
                    </div>
                    <div class="control-panel">
                <button class="btn btn-primary" onclick="calculateExpense()">计算分摊</button>
                <button class="btn btn-danger" onclick="clearExpenseResult()">清空结果</button>
            </div>
                </div>

                <div class="expense-result" id="expense-result" style="display: none;">
                    <h2 class="result-title">费用分摊结果</h2>
                    <div class="expense-summary" id="expense-summary"></div>
                    <div class="expense-details" id="expense-details">
                        <!-- Expense details will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

      <footer>
        </footer>

    <script>
let timerInterval;
let seconds = 0;
let timerRunning = false;

function toggleTimer() {
    const timerButton = document.getElementById('timer-button');
    if (timerRunning) {
        clearInterval(timerInterval);
        timerButton.textContent = '继续比赛';
    } else {
        timerInterval = setInterval(updateTimer, 1000);
        timerButton.textContent = '暂停比赛';
    }
    timerRunning = !timerRunning;
}

function updateTimer() {
    seconds++;
    const minutes = Math.floor(seconds / 60);
    const displaySeconds = seconds % 60;
    document.getElementById('match-timer').textContent = 
        `${minutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
}

function resetTimer() {
    clearInterval(timerInterval);
    seconds = 0;
    timerRunning = false;
    document.getElementById('match-timer').textContent = '00:00';
    document.getElementById('timer-button').textContent = '开始比赛';
}

        // Global variables
        let scoreA = 0;
        let scoreB = 0;
        let currentScreen = 'scoreboard';
        // 添加比赛结束时的时间和时长变量
        let finalMatchTime = 0;
        let finalMatchDate = null;
        // 全局变量 - 添加背景相关变量
        let currentBackgroundIndex = 0;
        const backgroundStyles = [
            // 1. 蓝色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createLinearGradient(0, 0, width, height);
                grad.addColorStop(0, '#4facfe');
                grad.addColorStop(1, '#00f2fe');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 2. 紫色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createLinearGradient(0, 0, width, 0);
                grad.addColorStop(0, '#8A2BE2');
                grad.addColorStop(1, '#9370DB');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 3. 粉色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width/2);
                grad.addColorStop(0, '#FF69B4');
                grad.addColorStop(1, '#FFC0CB');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 4. 网格纹理背景
            (ctx, width, height) => {
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, width, height);
                ctx.strokeStyle = 'rgba(0,0,0,0.05)';
                ctx.lineWidth = 1;
                const gridSize = 30;
                for(let i=0; i<=width; i+=gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, height);
                    ctx.stroke();
                }
                for(let i=0; i<=height; i+=gridSize) {
                    ctx.beginPath();
                    ctx.moveTo(0, i);
                    ctx.lineTo(width, i);
                    ctx.stroke();
                }
            },
            // 5. 金色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createLinearGradient(0, 0, 0, height);
                grad.addColorStop(0, '#FFD700');
                grad.addColorStop(1, '#FFA500');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 6. 绿色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createLinearGradient(0, height, width, 0);
                grad.addColorStop(0, '#3CB371');
                grad.addColorStop(1, '#98FB98');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 7. 红色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width);
                grad.addColorStop(0, '#FF4500');
                grad.addColorStop(1, '#DC143C');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 8. 波浪纹理背景 - 优化版
            (ctx, width, height) => {
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                
                // 优化：减少波浪数量并使用贝塞尔曲线替代逐点绘制
                const waveCount = 3; // 减少波浪数量
                const segmentWidth = 50; // 增加线段宽度，减少绘制点数
                
                for(let i=0; i<waveCount; i++){
                    ctx.beginPath();
                    ctx.moveTo(0, height/2 + Math.sin(i*0.5)*30);
                    
                    // 优化：使用贝塞尔曲线绘制波浪，减少计算点
                    for(let x=0; x<width; x+=segmentWidth){
                        const cp1x = x + segmentWidth/3;
                        const cp1y = height/2 + Math.sin((x + segmentWidth/3)/50 + i*0.5)*30;
                        const cp2x = x + segmentWidth*2/3;
                        const cp2y = height/2 + Math.sin((x + segmentWidth*2/3)/50 + i*0.5)*30;
                        const endX = x + segmentWidth;
                        const endY = height/2 + Math.sin(endX/50 + i*0.5)*30;
                        ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, endX, endY);
                    }
                    
                    ctx.lineTo(width, height);
                    ctx.lineTo(0, height);
                    ctx.closePath();
                    ctx.fill();
                }
            },
            // 9. 深色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createLinearGradient(0, 0, width, height);
                grad.addColorStop(0, '#1a2a6c');
                grad.addColorStop(1, '#b21f1f');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            },
            // 10. 紫色粉色渐变背景
            (ctx, width, height) => {
                const grad = ctx.createLinearGradient(0, 0, width, height);
                grad.addColorStop(0, '#9D50BB');
                grad.addColorStop(1, '#6E48AA');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, width, height);
            }
        ]

        // 添加背景缓存机制
        const backgroundCache = [];
        let isBackgroundCached = false;

        // 预缓存所有背景
        function cacheBackgrounds() {
            if (isBackgroundCached) return;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 600; // 匹配海报宽度
            canvas.height = 700; // 匹配海报高度
            
            // 缓存所有背景
            backgroundStyles.forEach((style, index) => {
                const offscreenCanvas = document.createElement('canvas');
                offscreenCanvas.width = canvas.width;
                offscreenCanvas.height = canvas.height;
                const offscreenCtx = offscreenCanvas.getContext('2d');
                
                // 绘制背景到离屏canvas
                style(offscreenCtx, canvas.width, canvas.height);
                
                // 存储缓存
                backgroundCache[index] = offscreenCanvas;
            });
            
            isBackgroundCached = true;
        }

        // 页面加载时预缓存背景
        window.addEventListener('load', cacheBackgrounds);

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set up navigation tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    navTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    // Hide all screens
                    document.querySelectorAll('.screen').forEach(screen => {
                        screen.classList.remove('active');
                    });
                    // Show selected screen
                    const screenId = this.getAttribute('data-screen');
                    document.getElementById(screenId).classList.add('active');
                    currentScreen = screenId;
                });
            });

            // 初始化时绑定事件监听（只绑定一次）
    const canvas = document.getElementById('posterCanvas');
    canvas.addEventListener('click', handleButtonClick);

    // Check for offline support
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('sw.js').then(function(registration) {
                console.log('ServiceWorker registration successful');
            }, function(err) {
                console.log('ServiceWorker registration failed: ', err);
            });
        });
    }
        });

        // Scoreboard functions
        function updateScore(team, amount) {
            if (!timerRunning) {
                alert('请先点击"开始比赛"才能调整比分');
                return;
            }
            if (team === 'a') {
                scoreA = Math.max(0, scoreA + amount);
                document.getElementById('team-a-score').textContent = scoreA;
            } else {
                scoreB = Math.max(0, scoreB + amount);
                document.getElementById('team-b-score').textContent = scoreB;
            }
            // Save score to localStorage for offline support
            localStorage.setItem('scoreA', scoreA);
            localStorage.setItem('scoreB', scoreB);
        }

        function resetScore() {
    scoreA = 0;
    scoreB = 0;
    document.getElementById('team-a-score').textContent = scoreA;
    document.getElementById('team-b-score').textContent = scoreB;
    document.getElementById('result-form').style.display = 'none';
    document.getElementById('result-card').style.display = 'none';
    localStorage.removeItem('scoreA');
    localStorage.removeItem('scoreB');
    resetTimer();
}

        function showResultForm() {
            document.getElementById('result-form').style.display = 'block';
            document.getElementById('result-card').style.display = 'none';
        }

        function generateResult() {
            const teamANames = document.getElementById('team-a-names').value;
            const teamBNames = document.getElementById('team-b-names').value;
            if (!teamANames || !teamBNames) {
                alert('请输入双方选手昵称');
                return;
            }
            const playerNames = `${teamANames} vs ${teamBNames}`;

            // 保存比赛结束时的时间和时长
            finalMatchTime = seconds; // 保存比赛时长（秒数）
            finalMatchDate = new Date(); // 保存比赛结束时间

            // Update result card
            document.getElementById('result-title-text').textContent = playerNames;
            document.getElementById('result-score-text').textContent = `${scoreA} - ${scoreB}`;
            document.getElementById('match-date').textContent = finalMatchDate.toLocaleString();

            // Show result card and hide form
            document.getElementById('result-form').style.display = 'none';
            document.getElementById('result-card').style.display = 'block';

            // Save match result to localStorage
            const matchResult = {
                players: playerNames,
                scoreA: scoreA,
                scoreB: scoreB,
                date: new Date().toISOString()
            };
            const matchHistory = JSON.parse(localStorage.getItem('matchHistory') || '[]');
            matchHistory.push(matchResult);
            localStorage.setItem('matchHistory', JSON.stringify(matchHistory));

            // 生成海报
            generatePoster();
        }

        function shareResult() {
            // In a real app, this would use the Web Share API if available
            // For this demo, we'll just copy to clipboard
            const resultText = `${document.getElementById('result-title-text').textContent}\n比分: ${document.getElementById('result-score-text').textContent}\n日期: ${document.getElementById('match-date').textContent}`;

            navigator.clipboard.writeText(resultText).then(function() {
                alert('赛果已复制到剪贴板，可以粘贴分享了！');
            }, function(err) {
                alert('无法复制文本: ', err);
            });
        }

        function generatePoster() {
    const canvas = document.getElementById('posterCanvas');
    const overlay = document.getElementById('posterOverlay');
    const ctx = canvas.getContext('2d');
    const teamANames = document.getElementById('team-a-names').value;
    const teamBNames = document.getElementById('team-b-names').value;
    const scoreA = parseInt(document.getElementById('team-a-score').textContent);
    const scoreB = parseInt(document.getElementById('team-b-score').textContent);
    const winner = scoreA > scoreB ? '己方' : '对方';
    const winnerText = '胜方';
    const loserText = '败方';
    const netScore = Math.abs(scoreA - scoreB);

    if (!teamANames || !teamBNames) {
        alert('请输入双方选手昵称');
        return;
    }
    // 验证比赛结束数据
    if (typeof finalMatchTime === 'undefined' || !finalMatchDate) {
        alert('请先结束比赛再生成海报');
        return;
    }

    // 使用比赛结束时保存的时长
    const minutes = Math.floor(finalMatchTime / 60);
    const matchTime = `${minutes}:${(finalMatchTime % 60).toString().padStart(2, '0')}`;

    // 设置canvas尺寸（只设置一次）
    const contentHeight = 700;
    canvas.width = 600;
    canvas.height = contentHeight;

    // 绘制背景（只绘制一次）
    if (isBackgroundCached && backgroundCache[currentBackgroundIndex]) {
        ctx.drawImage(backgroundCache[currentBackgroundIndex], 0, 0);
    } else {
        backgroundStyles[currentBackgroundIndex](ctx, canvas.width, canvas.height);
    }

            // 绘制标题
            ctx.font = 'bold 36px Arial';
            ctx.fillStyle = '#2c3e50';
            ctx.textAlign = 'center';
            ctx.fillText('羽毛球比赛结果', canvas.width / 2, 60);

            // 绘制选手信息 - 统一字体大小并添加空格对齐
        ctx.font = '24px Arial';  // 统一字体大小
        // 胜方文本（添加首尾空格保持长度一致）
        ctx.fillStyle = scoreA > scoreB ? '#e74c3c' : '#3498db';
        ctx.fillText(` ${teamANames} ${scoreA > scoreB ? winnerText : loserText} `, canvas.width / 2, 150);
        // 败方文本（添加首尾空格保持长度一致）
        ctx.fillStyle = scoreB > scoreA ? '#e74c3c' : '#3498db';
        ctx.fillText(` ${teamBNames} ${scoreB > scoreA ? winnerText : loserText} `, canvas.width / 2, 220);

            // 绘制比分
            ctx.font = 'bold 60px Arial';
            ctx.fillStyle = '#2c3e50';
            ctx.fillText(`${scoreA} - ${scoreB}`, canvas.width / 2, 320);

            // 绘制关键数据
            ctx.font = '20px Arial';
            ctx.fillStyle = '#7f8c8d';
            ctx.fillText(`比赛时长: ${matchTime}`, canvas.width / 2, 400);
            ctx.fillText(`净胜分: ${netScore}分`, canvas.width / 2, 440);
            ctx.fillText(`胜者: ${winner}`, canvas.width / 2, 480);

            // 将时间移到胜者信息下方（Y坐标调整为540）
            // 使用比赛结束时保存的时间
            const timeStr = finalMatchDate.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }).replace(/\//g, '-');
            ctx.fillText(`时间: ${timeStr}`, canvas.width / 2, 540); // 原Y坐标: 1040
            
            // 将水印移到时间下方（Y坐标调整为600）
            ctx.save();
            ctx.font = 'italic bold 36px Arial, SimHei';
            // 创建渐变效果
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
            gradient.addColorStop(0, 'rgba(100, 149, 237, 0.7)');
            gradient.addColorStop(1, 'rgba(255, 105, 180, 0.7)');
            ctx.fillStyle = gradient;
            ctx.textAlign = 'center';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 5;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            // 绘制水印文字
            ctx.fillText('羽毛球极速计分板 | 亍幵', canvas.width / 2, 600); // 原Y坐标: 1120
            ctx.restore();
            
        
            // 绘制分享引导
        ctx.font = 'italic 22px Arial';
        ctx.fillStyle = '#3498db';

    // 优化按钮点击区域计算
    const buttonWidth = 120;
    const buttonHeight = 40;
    const buttonY = canvas.height - 60;
    const buttonPadding = 20;
    const totalButtonWidth = (buttonWidth * 3) + (buttonPadding * 2);
    const startX = (canvas.width - totalButtonWidth) / 2;

    // 绘制分享海报按钮
    ctx.fillStyle = '#3498db';
    ctx.fillRect(startX, buttonY, buttonWidth, buttonHeight);
    ctx.fillStyle = 'white';
    ctx.font = '16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('分享海报', startX + buttonWidth/2, buttonY + buttonHeight/2);

    // 绘制关闭海报按钮
    ctx.fillStyle = '#e74c3c';
    ctx.fillRect(startX + buttonWidth + buttonPadding, buttonY, buttonWidth, buttonHeight);
    ctx.fillStyle = 'white';
    ctx.fillText('关闭海报', startX + buttonWidth + buttonPadding + buttonWidth/2, buttonY + buttonHeight/2);

    // 绘制切换背景按钮
    ctx.fillStyle = '#2ecc71';
    ctx.fillRect(startX + buttonWidth*2 + buttonPadding*2, buttonY, buttonWidth, buttonHeight);
    ctx.fillStyle = 'white';
    ctx.fillText('切换背景', startX + buttonWidth*2 + buttonPadding*2 + buttonWidth/2, buttonY + buttonHeight/2);

    // 存储按钮位置供事件处理使用
    canvas.buttonAreas = {
        share: {x: startX, y: buttonY, width: buttonWidth, height: buttonHeight},
        close: {x: startX + buttonWidth + buttonPadding, y: buttonY, width: buttonWidth, height: buttonHeight},
        changeBg: {x: startX + buttonWidth*2 + buttonPadding*2, y: buttonY, width: buttonWidth, height: buttonHeight}
    };











        


        // 显示海报和遮罩
        overlay.style.display = 'block';
        canvas.style.display = 'block';
        // ==== 新增居中样式 ====
        canvas.style.margin = '0 auto';
        canvas.style.position = 'absolute';
        canvas.style.top = '50%';
        canvas.style.left = '50%';
        canvas.style.transform = 'translate(-50%, -50%)';
        canvas.style.transformOrigin = 'center center';
        // ======================
        document.getElementById('closePosterBtn').style.display = 'none';
        document.getElementById('sharePosterBtn').style.display = 'none';
            // 添加微信环境检测提示
            if (navigator.userAgent.includes('MicroMessenger')) {
                const wechatTip = document.createElement('div');
                wechatTip.textContent = '微信用户请点击"分享海报"后长按保存';
                wechatTip.style.position = 'fixed';
                wechatTip.style.bottom = '180px';
                wechatTip.style.left = '50%';
                wechatTip.style.transform = 'translateX(-50%)';
                wechatTip.style.color = '#3498db';
                wechatTip.style.fontSize = '14px';
                wechatTip.style.padding = '5px 10px';
                wechatTip.style.backgroundColor = 'rgba(255,255,255,0.8)';
                wechatTip.style.borderRadius = '4px';
                wechatTip.id = 'wechatEnvironmentTip';
                document.body.appendChild(wechatTip);
            }
        }

        // 关闭海报
        function closePoster() {
            document.getElementById('posterCanvas').style.display = 'none';
            document.getElementById('posterOverlay').style.display = 'none';
            document.getElementById('closePosterBtn').style.display = 'none';
            document.getElementById('sharePosterBtn').style.display = 'none';
        }

        // 保存海报图片
        function savePoster() {
    const canvas = document.getElementById('posterCanvas');
    const isWechat = navigator.userAgent.includes('MicroMessenger');
    const imageURL = canvas.toDataURL('image/png');
    
    // 检测QQ环境并调整保存策略
    const isQQ = navigator.userAgent.toLowerCase().indexOf('qq/') > -1 || navigator.userAgent.toLowerCase().indexOf('mqqbrowser') > -1;

    if (isQQ) {
        // QQ环境下的保存逻辑
        alert('请长按图片选择"保存图片"到相册');
        // 创建适合QQ的预览模式
        const qqViewer = document.createElement('div');
        qqViewer.style.position = 'fixed';
        qqViewer.style.top = '0';
        qqViewer.style.left = '0';
        qqViewer.style.width = '100%';
        qqViewer.style.height = '100%';
        qqViewer.style.backgroundColor = 'rgba(0,0,0,0.9)';
        qqViewer.style.display = 'flex';
        qqViewer.style.alignItems = 'center';
        qqViewer.style.justifyContent = 'center';
        qqViewer.style.zIndex = '9999';

        const qqImg = document.createElement('img');
        qqImg.src = imageURL;
        qqImg.style.maxWidth = '90%';
        qqImg.style.maxHeight = '80vh';
        qqImg.style.border = '8px solid white';

        const closeBtn = document.createElement('button');
        closeBtn.textContent = '关闭';
        closeBtn.style.position = 'absolute';
        closeBtn.style.top = '20px';
        closeBtn.style.right = '20px';
        closeBtn.style.padding = '8px 16px';
        closeBtn.style.backgroundColor = 'white';
        closeBtn.style.border = 'none';
        closeBtn.style.borderRadius = '4px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.onclick = () => qqViewer.remove();

        qqViewer.appendChild(qqImg);
        qqViewer.appendChild(closeBtn);
        document.body.appendChild(qqViewer);
    } else if (isWechat) {
        // 微信环境：长按保存模式
        const posterImg = document.createElement('img');
        posterImg.src = imageURL;
        posterImg.style.maxWidth = '90%';
        posterImg.style.maxHeight = '80vh';
        posterImg.style.border = '8px solid white';
        posterImg.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
        // ==== 确保微信预览也居中 ====
        posterImg.style.margin = '0 auto';
        // ===========================
        
        const wechatContainer = document.createElement('div');
        wechatContainer.style.position = 'fixed';
        wechatContainer.style.top = '0';
        wechatContainer.style.left = '0';
        wechatContainer.style.width = '100%';
        wechatContainer.style.height = '100%';
        wechatContainer.style.backgroundColor = 'rgba(0,0,0,0.85)';
        wechatContainer.style.display = 'flex';
        wechatContainer.style.flexDirection = 'column';
        wechatContainer.style.justifyContent = 'center';
        wechatContainer.style.alignItems = 'center';
        wechatContainer.style.zIndex = '9999';
        wechatContainer.id = 'wechatSaveContainer';
        
        const tipText = document.createElement('div');
        tipText.textContent = '长按图片选择"保存图片"';
        tipText.style.color = 'white';
        tipText.style.fontSize = '18px';
        tipText.style.marginTop = '20px';
        
        const closeBtn = document.createElement('div');
        closeBtn.textContent = '关闭';
        closeBtn.style.color = 'white';
        closeBtn.style.fontSize = '16px';
        closeBtn.style.marginTop = '15px';
        closeBtn.style.padding = '8px 20px';
        closeBtn.style.border = '1px solid white';
        closeBtn.style.borderRadius = '20px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.onclick = () => document.body.removeChild(wechatContainer);
        
        wechatContainer.appendChild(posterImg);
        wechatContainer.appendChild(tipText);
        wechatContainer.appendChild(closeBtn);
        document.body.appendChild(wechatContainer);
    } else {
        // 浏览器环境：直接下载
        const link = document.createElement('a');
        link.download = '羽毛球比赛结果海报.png';
        link.href = imageURL;
        link.click();
        alert('海报已下载，请到下载文件夹查看');
        return;
    }
}

        // 事件处理函数移到外部并缓存
        function handleButtonClick(e) {
            const canvas = document.getElementById('posterCanvas');
            if (!canvas.buttonAreas) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            // 使用预计算的按钮区域
            const areas = canvas.buttonAreas;
            if (x >= areas.share.x && x <= areas.share.x + areas.share.width && y >= areas.share.y && y <= areas.share.y + areas.share.height) {
                savePoster();
            } else if (x >= areas.close.x && x <= areas.close.x + areas.close.width && y >= areas.close.y && y <= areas.close.y + areas.close.height) {
                closePoster();
            } else if (x >= areas.changeBg.x && x <= areas.changeBg.x + areas.changeBg.width && y >= areas.changeBg.y && y <= areas.changeBg.y + areas.changeBg.height) {
                requestAnimationFrame(() => {
                    currentBackgroundIndex = (currentBackgroundIndex + 1) % backgroundStyles.length;
                    generatePoster();
                });
            }
        }

        // Grouping functions
        function randomGroups() {
            const playersText = document.getElementById('players-list').value;
            if (!playersText) {
                alert('请输入参与人员');
                return;
            }

            // Split players into array and filter out empty lines
            let players = playersText.split('\n').filter(p => p.trim() !== '');

            // Shuffle players array
            for (let i = players.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [players[i], players[j]] = [players[j], players[i]];
            }

            // Create groups (pairs for doubles)
            const groups = [];
            for (let i = 0; i < players.length; i += 2) {
                if (i + 1 < players.length) {
                    groups.push([players[i], players[i + 1]]);
                } else {
                    // If odd number of players, add last one to the last group
                    if (groups.length > 0) {
                        groups[groups.length - 1].push(players[i]);
                    } else {
                        groups.push([players[i]]);
                    }
                }
            }

            // Display groups with flip animation
            const resultsContainer = document.getElementById('group-results');
            resultsContainer.innerHTML = '';

            groups.forEach((group, index) => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card';
                groupCard.innerHTML = `
                    <div class="group-card-front">
                        <div class="group-number">${index + 1}</div>
                        <div>组</div>
                    </div>
                    <div class="group-card-back">
                        ${group.map(player => `<div>${player}</div>`).join('')}
                    </div>
                `;
                resultsContainer.appendChild(groupCard);

                // Add flip animation after a short delay
                setTimeout(() => {
                    groupCard.classList.add('flipped');
                }, 100 * index);
            });

            // Save groups to localStorage
            localStorage.setItem('lastGroups', JSON.stringify(groups));
        }

        function clearGroups() {
            document.getElementById('group-results').innerHTML = '';
            document.getElementById('players-list').value = '';
        }

        // Expense tracker functions
        function generateParticipants() {
            const playersText = document.getElementById('expense-players').value;
            if (!playersText) {
                alert('请输入参与人员');
                return;
            }

            // Split players into array and filter out empty lines
            const players = playersText.split('\n').filter(p => p.trim() !== '');

            // Generate checkboxes for participants
            const participantsContainer = document.getElementById('participants-list');
            participantsContainer.innerHTML = '';

            players.forEach((player, index) => {
                const checkboxId = `participant-${index}`;
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = checkboxId;
                checkbox.className = 'participant-checkbox';
                checkbox.value = player;
                checkbox.checked = true;

                const label = document.createElement('label');
                label.htmlFor = checkboxId;
                label.className = 'participant-label';
                label.textContent = player;

                participantsContainer.appendChild(checkbox);
                participantsContainer.appendChild(label);
            });
        }

        function clearExpenseResult() {
            document.getElementById('expense-result').style.display = 'none';
            document.getElementById('total-amount').value = '';
        }

        function calculateExpense() {
            const expenseType = document.getElementById('expense-type').value;
            const totalAmount = parseFloat(document.getElementById('total-amount').value);
            const checkboxes = document.querySelectorAll('.participant-checkbox:checked');

            if (isNaN(totalAmount) || totalAmount <= 0) {
                alert('请输入有效的总金额');
                return;
            }

            if (checkboxes.length === 0) {
                alert('请选择参与人员');
                return;
            }

            // Calculate per person cost
            const perPerson = totalAmount / checkboxes.length;
            const participants = Array.from(checkboxes).map(cb => cb.value);

            // Display results
            const resultContainer = document.getElementById('expense-result');
            const summaryContainer = document.getElementById('expense-summary');
            const detailsContainer = document.getElementById('expense-details');

            summaryContainer.textContent = `${expenseType}：${totalAmount.toFixed(2)}元，共${checkboxes.length}人参与，人均：${perPerson.toFixed(2)}元`;
            detailsContainer.innerHTML = '';

            participants.forEach(participant => {
                const detailItem = document.createElement('div');
                detailItem.className = 'detail-item';
                detailItem.innerHTML = `
                    <span>${participant}</span>
                    <span>${perPerson.toFixed(2)}元</span>
                `;
                detailsContainer.appendChild(detailItem);
            });

            // Show result
            resultContainer.style.display = 'block';

            // Save expense to localStorage
            const expenseRecord = {
                type: expenseType,
                total: totalAmount,
                perPerson: perPerson,
                participants: participants,
                date: new Date().toISOString()
            };
            const expenseHistory = JSON.parse(localStorage.getItem('expenseHistory') || '[]');
            expenseHistory.push(expenseRecord);
            localStorage.setItem('expenseHistory', JSON.stringify(expenseHistory));
        }
    </script>
        <!-- 海报Canvas (隐藏) -->
        <canvas id="posterCanvas" width="1200" height="1600" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.5); width: 600px; height: 800px; border: 8px solid white; box-shadow: 0 0 0 1px #e0e0e0, 0 4px 12px rgba(0,0,0,0.15); outline: 1px solid #f0f0f0; outline-offset: -5px; z-index: 1000;"></canvas>
        <div id="posterOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999;"></div>
        <!-- 添加右上角关闭按钮 -->
        <div id="sharePosterBtn" onclick="savePoster()" style="display: none; position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #3498db; color: white; padding: 12px 24px; border-radius: 5px; font-size: 20px; cursor: pointer; z-index: 1001; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">分享海报</div>
        <div id="closePosterBtn" onclick="closePoster()" style="display: none; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #e74c3c; color: white; padding: 10px 20px; border-radius: 5px; font-size: 18px; cursor: pointer; z-index: 1001; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">关闭海报</div>

</body>
</html>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
        </div>
       